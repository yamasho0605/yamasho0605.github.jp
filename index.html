<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>浜田高校オープンスクール</title>
    <!-- Tailwind CSS CDNを読み込み -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts (M PLUS Rounded 1c と Noto Sans JP) を読み込み -->
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@700;800&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* フォント設定 */
        body {
            font-family: 'Noto Sans JP', sans-serif;
            /* background-color: #000000; /* 少し紫がかった背景色 */ /* この行を削除またはコメントアウト */
        }
        h1, h2, h3, button {
            font-family: 'M PLUS Rounded 1c', sans-serif;
        }
        /* 見出しのグラデーション背景 */
        .header-gradient {
            background: linear-gradient(135deg, #c084fc, #a855f7, #9333ea); /* 紫色のグラデーション */
        }
        /* ローディングスピナー */
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #a855f7; /* 紫色 */
            width: 24px;
            height: 24px;
            animation: spin 1.5s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* スムーズな表示のためのトランジション */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-purple-200">

    <div class="container mx-auto p-4 max-w-6xl">

        <!-- ヘッダーセクション: 浜田高校オープンスクールのタイトルを表示 -->
        <header class="header-gradient text-white p-6 rounded-xl shadow-lg mb-8">
            <h1 class="text-4xl md:text-5xl font-extrabold text-center tracking-wider">浜田高校オープンスクール</h1>
        </header>

        <main class="grid grid-cols-1 md:grid-cols-3 gap-8">

            <!-- 左側コンテンツエリア: 詳細情報、プランナー、チャット、メッセージ、校長挨拶 -->
            <div class="md:col-span-2 space-y-8">
                <!-- 詳細情報セクション: オープンスクールの基本情報 -->
                <section class="bg-white p-8 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 border-b-4 border-purple-400 pb-2 mb-6">オープンスクールの詳細</h2>
                    <div class="space-y-4 text-gray-700">
                        <p><strong>開催日時:</strong> 2025年8月23日（土） 9:00 〜 12:00 (受付開始 8:30)</p>
                        <p><strong>場所:</strong> 島根県立浜田高等学校 各教室・体育館</p>
                        <p><strong>対象:</strong> 中学生およびその保護者、中学校教員</p>
                        <p><strong>内容:</strong></p>
                        <ul class="list-disc list-inside pl-4 space-y-2">
                            <li>学校概要説明</li>
                            <li>体験授業（国語、数学、理科、社会、英語など）</li>
                            <li>部活動見学・体験</li>
                            <li>在校生との交流会</li>
                            <li>個別相談コーナー</li>
                        </ul>
                        <p class="mt-4">浜田高校の魅力を存分に感じていただけるプログラムを多数ご用意しています。ぜひ、ご参加ください！</p>
                         <button class="mt-6 w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-transform transform hover:scale-105">
                            参加申し込みはこちら
                        </button>
                    </div>
                </section>

                <!-- パーソナルプランナーセクション: AIがおすすめプランを提案 -->
                <section class="bg-white p-8 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 border-b-4 border-purple-400 pb-2 mb-6">✨ オープンスクール・パーソナルプランナー</h2>
                    <p class="text-gray-600 mb-4">あなたの興味に合わせて、おすすめの1日のプランをAIが提案します！</p>
                    <div class="space-y-4">
                        <div>
                            <h3 class="font-semibold text-gray-700">興味のある教科は？ (複数選択可)</h3>
                            <div id="subject-interests" class="grid grid-cols-2 sm:grid-cols-3 gap-2 mt-2">
                                <label class="flex items-center space-x-2 p-2 rounded-lg bg-gray-100 hover:bg-gray-200 cursor-pointer"><input type="checkbox" value="国語" class="form-checkbox h-5 w-5 text-purple-500 rounded"><span>国語</span></label>
                                <label class="flex items-center space-x-2 p-2 rounded-lg bg-gray-100 hover:bg-gray-200 cursor-pointer"><input type="checkbox" value="数学" class="form-checkbox h-5 w-5 text-purple-500 rounded"><span>数学</span></label>
                                <label class="flex items-center space-x-2 p-2 rounded-lg bg-gray-100 hover:bg-gray-200 cursor-pointer"><input type="checkbox" value="理科" class="form-checkbox h-5 w-5 text-purple-500 rounded"><span>理科</span></label>
                                <label class="flex items-center space-x-2 p-2 rounded-lg bg-gray-100 hover:bg-gray-200 cursor-pointer"><input type="checkbox" value="社会" class="form-checkbox h-5 w-5 text-purple-500 rounded"><span>社会</span></label>
                                <label class="flex items-center space-x-2 p-2 rounded-lg bg-gray-100 hover:bg-gray-200 cursor-pointer"><input type="checkbox" value="英語" class="form-checkbox h-5 w-5 text-purple-500 rounded"><span>英語</span></label>
                            </div>
                        </div>
                         <div>
                            <h3 class="font-semibold text-gray-700">興味のある部活動は？</h3>
                            <div id="club-interests" class="flex flex-wrap gap-2 mt-2">
                                <label class="flex items-center space-x-2 p-2 rounded-lg bg-gray-100 hover:bg-gray-200 cursor-pointer"><input type="radio" name="club" value="運動部" class="form-radio h-5 w-5 text-purple-500"><span>運動部</span></label>
                                <label class="flex items-center space-x-2 p-2 rounded-lg bg-gray-100 hover:bg-gray-200 cursor-pointer"><input type="radio" name="club" value="文化部" class="form-radio h-5 w-5 text-purple-500"><span>文化部</span></label>
                                <label class="flex items-center space-x-2 p-2 rounded-lg bg-gray-100 hover:bg-gray-200 cursor-pointer"><input type="radio" name="club" value="どちらも" class="form-radio h-5 w-5 text-purple-500"><span>どちらも</span></label>
                            </div>
                        </div>
                        <button id="create-plan-btn" class="mt-4 w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-transform transform hover:scale-105 flex items-center justify-center">
                            <span class="text-lg">あなただけのプランを作成</span>
                        </button>
                    </div>
                    <!-- プランのAI生成結果が表示されるエリア -->
                    <div id="plan-result" class="mt-6 p-6 bg-purple-50 rounded-lg border border-purple-200" style="display: none;">
                        <!-- AIからの提案がここに表示される -->
                    </div>
                </section>
                
                <!-- AIチャット相談室: AIに質問できるセクション -->
                <section class="bg-white p-8 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 border-b-4 border-purple-400 pb-2 mb-6">💬 AIチャット相談室</h2>
                    <p class="text-gray-600 mb-4">浜田高校やオープンスクールについて、AIに何でも質問してみよう！</p>
                    <div class="space-y-4">
                        <textarea id="qa-question" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-400 transition" rows="3" placeholder="例：理数科ではどんなことが学べますか？"></textarea>
                        <button id="ask-ai-btn" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-transform transform hover:scale-105 flex items-center justify-center">
                            <span class="text-lg">AIに質問する</span>
                        </button>
                    </div>
                    <!-- AIからの回答が表示されるエリア -->
                    <div id="qa-answer" class="mt-6 p-6 bg-purple-50 rounded-lg border border-purple-200" style="display: none;">
                        <!-- AIからの回答がここに表示される -->
                    </div>
                </section>

                <!-- 在校生の感想セクション: 在校生からのメッセージを表示 -->
                <section class="bg-white p-8 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 border-b-4 border-purple-400 pb-2 mb-6">在校生からのメッセージ</h2>
                    <div id="student-message-1" class="flex items-start space-x-6">
                        <div class="w-20 h-20 rounded-full bg-purple-500 flex-shrink-0 flex items-center justify-center text-white text-3xl font-bold shadow-lg">
                            <span>声</span>
                        </div>
                        <div class="bg-purple-50 p-6 rounded-lg flex-grow">
                            <p class="font-semibold text-purple-800">「最初は緊張したけど、先輩たちが優しく教えてくれて、授業も部活もすごく楽しかったです！浜高の雰囲気がよく分かりました。」</p>
                            <p class="text-right mt-2 text-sm text-gray-600">- 普通科2年 女子</p>
                        </div>
                    </div>
                     <div id="student-message-2" class="flex items-start space-x-6 mt-6">
                        <div class="w-20 h-20 rounded-full bg-purple-400 flex-shrink-0 flex items-center justify-center text-white text-3xl font-bold shadow-lg">
                            <span>声</span>
                        </div>
                        <div class="bg-purple-50 p-6 rounded-lg flex-grow">
                            <p class="font-semibold text-purple-800">「体験授業で高校の勉強のレベルの高さを感じました。難しいけど面白そうで、ますます浜高で学びたくなりました。」</p>
                            <p class="text-right mt-2 text-sm text-gray-600">- 理数科志望 男子</p>
                        </div>
                    </div>
                    <button id="new-message-btn" class="mt-6 w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-transform transform hover:scale-105 flex items-center justify-center">
                        <span class="text-lg">新しいメッセージを見る</span>
                    </button>
                </section>

                <!-- 校長先生の紹介セクション: 校長先生からの挨拶と写真 -->
                <section class="bg-white p-8 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 border-b-4 border-purple-400 pb-2 mb-6">校長先生からのご挨拶</h2>
                    <div class="flex flex-col sm:flex-row items-center gap-6">
                        <div class="flex-shrink-0">
                            <!-- 校長先生の顔写真。読み込みエラー時のフォールバックも設定 -->
                            <img src="https://placehold.co/150x150/a855f7/ffffff?text=校長先生" alt="校長先生の顔写真" class="rounded-full shadow-lg object-cover">
                        </div>
                        <div class="flex-grow">
                            <p class="text-gray-700 leading-relaxed">
                                中学生の皆さん、こんにちは。浜田高校のオープンスクールへようこそ。<br>
                                本校は、長い歴史と伝統の中で「石見の雄」として地域社会を担う人材を育成してまいりました。このオープンスクールでは、活気あふれる授業や部活動、そして何より生徒たちの自主性を重んじる校風を肌で感じていただきたいと思います。<br>
                                皆さんが自らの夢を見つけ、挑戦できるよう、我々教職員一同、全力でサポートします。今日一日が、皆さんにとって有意義な時間となることを心より願っています。
                            </p>
                            <div class="mt-4 text-right">
                                <p class="font-semibold text-gray-700">島根県立浜田高等学校 校長</p>
                                <p class="font-bold text-xl text-gray-800">志波 英樹</p>
                            </div>
                        </div>
                    </div>
                </section>

            </div>

            <!-- 右側コンテンツエリア: キャンパス風景と学校のシンボル写真 -->
            <div class="md:col-span-1 space-y-8">
                <section class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">キャンパス風景</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <!-- キャンパス風景の画像。読み込みエラー時のフォールバックも設定 -->
                        <img src="https://www.hamada-h.ed.jp/wp-content/uploads/2023/04/IMG_3962-1024x768.jpg" alt="浜田高校 桜と校舎" class="rounded-lg shadow-md w-full h-auto object-cover aspect-square" onerror="this.onerror=null;this.src='https://placehold.co/400x300/cccccc/ffffff?text=画像読込エラー';">
                        <img src="https://www.hamada-h.ed.jp/wp-content/uploads/2021/04/P1000305-1024x768.jpg" alt="浜田高校 正門" class="rounded-lg shadow-md w-full h-auto object-cover aspect-square" onerror="this.onerror=null;this.src='https://placehold.co/400x300/cccccc/ffffff?text=画像読込エラー';">
                        <img src="https://www.hamada-h.ed.jp/wp-content/uploads/2021/04/P1000304-1024x768.jpg" alt="浜田高校 くすのき" class="rounded-lg shadow-md w-full h-auto object-cover aspect-square" onerror="this.onerror=null;this.src='https://placehold.co/400x300/cccccc/ffffff?text=画像読込エラー';">
                        <img src="https://www.hamada-h.ed.jp/wp-content/uploads/2021/04/P1000302-1024x768.jpg" alt="浜田高校 校舎遠景" class="rounded-lg shadow-md w-full h-auto object-cover aspect-square" onerror="this.onerror=null;this.src='https://placehold.co/400x300/cccccc/ffffff?text=画像読込エラー';">
                    </div>
                </section>
                <section class="bg-white p-6 rounded-xl shadow-md">
                     <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">学校のシンボル</h3>
                     <!-- 学校のシンボル画像。読み込みエラー時のフォールバックも設定 -->
                     <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/Shimane_Prefectural_Hamada_High_School.JPG/1200px-Shimane_Prefectural_Hamada_High_School.JPG" alt="島根県立浜田高等学校の校舎" class="rounded-lg shadow-md w-full h-auto" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=画像読込エラー';">
                </section>
            </div>
        </main>

        <!-- フッターセクション: 学校の連絡先情報 -->
        <footer class="text-center text-sm text-gray-600 bg-white mt-8 p-6 rounded-xl shadow-md">
            <p class="font-bold text-lg">島根県立浜田高等学校</p>
            <p>〒697-0024 島根県浜田市黒川町3749番地</p>
            <p>TEL: 0855-22-0042</p>
        </footer>
    </div>

    <script type="module">
        // --- ユーティリティ関数と定数 ---
        // APIキーはCanvas環境で自動的に提供されるため、空の文字列のままにします。
        const API_KEY = "";
        // Gemini APIのエンドポイントURL
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;

        /**
         * ローディング表示のHTML文字列を生成する関数
         * @param {string} text - ローディング中に表示するテキスト
         * @returns {string} - ローディング表示のHTML文字列
         */
        function createLoaderHTML(text) {
            return `<div class="flex justify-center items-center p-4"><div class="loader"></div><p class="ml-4 text-gray-600">${text}</p></div>`;
        }

        /**
         * Gemini APIを呼び出す汎用非同期関数
         * @param {object} payload - APIに送信するペイロード（contents, generationConfigなど）
         * @returns {Promise<string|object>} - APIからのレスポンス（テキストまたはJSONオブジェクト）、エラーの場合はエラーオブジェクト
         */
        async function callGemini(payload) {
            try {
                // APIリクエストを送信
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                // HTTPステータスコードが200番台以外の場合はエラーをスロー
                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }

                // レスポンスをJSONとしてパース
                const result = await response.json();

                // 応答構造が期待通りか確認し、コンテンツを抽出
                if (result.candidates && result.candidates[0]?.content?.parts?.[0]) {
                    const part = result.candidates[0].content.parts[0];
                    // JSON応答を期待する場合はtextをパースし、そうでなければtextをそのまま返す
                    if (payload.generationConfig?.responseMimeType === 'application/json') {
                         try {
                            return JSON.parse(part.text);
                         } catch(e) {
                            // JSONパースエラーが発生した場合
                            console.error("Failed to parse JSON response:", part.text);
                            throw new Error("AIからの応答形式が正しくありません。");
                         }
                    }
                    return part.text; // テキスト応答の場合
                } else {
                    // 予期しないAPI応答構造の場合
                    console.error('Unexpected API response structure:', result);
                    throw new Error("AIからの応答がありませんでした。");
                }
            } catch (error) {
                // API呼び出し中に発生したエラーをキャッチ
                console.error("Error calling Gemini API:", error);
                return { error: error.message || "不明なエラーが発生しました。" };
            }
        }

        // --- パーソナルプランナー機能 ---
        // DOM要素の取得
        const createPlanBtn = document.getElementById('create-plan-btn');
        const planResultEl = document.getElementById('plan-result');

        // プラン作成ボタンのクリックイベントリスナー
        createPlanBtn.addEventListener('click', async () => {
            // 選択された教科と部活動の情報を取得
            const selectedSubjects = Array.from(document.querySelectorAll('#subject-interests input:checked')).map(el => el.value);
            const selectedClub = document.querySelector('#club-interests input:checked')?.value;

            // 必須項目が選択されているか確認
            if (selectedSubjects.length === 0 || !selectedClub) {
                planResultEl.innerHTML = '<p class="text-red-600 font-bold">教科と部活動の両方を選択してください。</p>';
                planResultEl.style.display = 'block';
                return;
            }

            // ローディング表示とボタンの無効化
            planResultEl.style.display = 'block';
            planResultEl.innerHTML = createLoaderHTML('AIがプランを作成中です...');
            createPlanBtn.disabled = true;

            // Gemini APIへのプロンプトを生成
            const prompt = `あなたは島根県立浜田高等学校の親切な進路指導の先生です。ある中学生がオープンスクールに参加します。以下の情報に基づいて、その生徒に最適なオープンスクールの体験プランを提案してください。

# 生徒の興味・関心
- 興味のある教科: ${selectedSubjects.join('、')}
- 興味のある部活の種類: ${selectedClub}

# 出力形式
JSON形式で、以下のschemaに従って、生徒がワクワクするようなパーソナルプランを提案してください。
`;

            // 期待するJSONスキーマの定義
            const schema = {
                type: "OBJECT",
                properties: {
                    title: { type: "STRING" },
                    schedule: {
                        type: "ARRAY",
                        items: {
                            type: "OBJECT",
                            properties: {
                                time: { type: "STRING" },
                                activity: { type: "STRING" },
                                description: { type: "STRING" }
                            },
                            required: ["time", "activity", "description"]
                        }
                    }
                },
                required: ["title", "schedule"]
            };

            // APIリクエストのペイロード
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: schema
                }
            };
            
            // Gemini APIを呼び出し
            const result = await callGemini(payload);

            // 結果の表示
            if (result.error) {
                planResultEl.innerHTML = `<p class="text-red-600 font-bold">エラー: ${result.error}</p>`;
            } else {
                let htmlResult = `<h3 class="text-xl font-bold text-purple-800 mb-4 fade-in">${result.title}</h3>`;
                htmlResult += '<ul class="space-y-3">';
                result.schedule.forEach(item => {
                    htmlResult += `
                        <li class="fade-in">
                            <p class="font-bold text-purple-700">${item.time}：${item.activity}</p>
                            <p class="text-gray-600 pl-4">${item.description}</p>
                        </li>
                    `;
                });
                htmlResult += '</ul>';
                planResultEl.innerHTML = htmlResult;
            }
            // ボタンを再度有効化
            createPlanBtn.disabled = false;
        });

        // --- AIチャット相談室 ---
        // DOM要素の取得
        const askAiBtn = document.getElementById('ask-ai-btn');
        const qaQuestionEl = document.getElementById('qa-question');
        const qaAnswerEl = document.getElementById('qa-answer');

        // 質問ボタンのクリックイベントリスナー
        askAiBtn.addEventListener('click', async () => {
            const question = qaQuestionEl.value.trim();
            // 質問が空でないか確認
            if (!question) {
                qaAnswerEl.innerHTML = '<p class="text-red-600 font-bold">質問を入力してください。</p>';
                qaAnswerEl.style.display = 'block';
                return;
            }

            // ローディング表示と要素の無効化
            qaAnswerEl.style.display = 'block';
            qaAnswerEl.innerHTML = createLoaderHTML('AIが回答を考えています...');
            askAiBtn.disabled = true;
            qaQuestionEl.disabled = true;

            // Gemini APIへのプロンプトを生成
            const prompt = `あなたは島根県立浜田高等学校に関する質問に答える、親切で優秀なAIアシスタントです。以下の質問に対して、中学生にも分かりやすく、丁寧な言葉で回答を作成してください。

# 質問
${question}

# 回答の注意点
- 浜田高校の公式情報や一般的な知識に基づいて回答してください。
- 不明な点や、答えるべきでない個人的な情報については、「学校の先生に直接聞いてみてくださいね」といった形で、正直に回答を避けてください。
- 回答はMarkdown形式で、読みやすく整形してください。
`;
            // APIリクエストのペイロード (テキスト応答を期待)
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                generationConfig: { temperature: 0.7 } // 回答の多様性を調整
            };

            // Gemini APIを呼び出し
            const resultText = await callGemini(payload);
            
            // 結果の表示
            if (resultText.error) {
                qaAnswerEl.innerHTML = `<p class="text-red-600 font-bold">エラー: ${resultText.error}</p>`;
            } else {
                // 簡単なMarkdownをHTMLに変換して表示
                let htmlResult = resultText
                    .replace(/### (.*)/g, '<h3 class="text-lg font-bold text-purple-800 mt-4 mb-2">$1</h3>')
                    .replace(/## (.*)/g, '<h2 class="text-xl font-bold text-purple-800 mt-4 mb-2">$1</h2>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/^- (.*)/gm, '<li class="list-disc list-inside ml-4 mb-1">$1</li>')
                    .replace(/\n/g, '<br>'); // 改行を<br>に変換
                qaAnswerEl.innerHTML = `<div class="fade-in">${htmlResult}</div>`;
            }

            // ボタンとテキストエリアを再度有効化
            askAiBtn.disabled = false;
            qaQuestionEl.disabled = false;
        });


        // --- 在校生メッセージ機能 ---
        // DOM要素の取得
        const newMessageBtn = document.getElementById('new-message-btn');
        const messageContainer = document.getElementById('student-message-2'); // 2番目のメッセージコンテナを更新対象とする
        // メッセージ表示の背景色とテキスト色のバリエーション
        const messageColors = [
            { bg: 'bg-purple-50', text: 'text-purple-800', icon: 'bg-purple-500' },
            { bg: 'bg-violet-50', text: 'text-violet-800', icon: 'bg-violet-500' },
            { bg: 'bg-fuchsia-50', text: 'text-fuchsia-800', icon: 'bg-fuchsia-500' },
            { bg: 'bg-indigo-50', text: 'text-indigo-800', icon: 'bg-indigo-500' },
        ];
        let colorIndex = 0; // 色のインデックスを追跡

        // 新しいメッセージを見るボタンのクリックイベントリスナー
        newMessageBtn.addEventListener('click', async () => {
            // ローディング表示とボタンの無効化
            messageContainer.innerHTML = createLoaderHTML('新しいメッセージを生成中...');
            newMessageBtn.disabled = true;

            // Gemini APIへのプロンプトを生成
            const prompt = `あなたは島根県立浜田高等学校の在校生です。オープンスクールに来てくれた中学生に向けて、浜田高校の魅力が伝わるような、短くて元気の出る応援メッセージを作成してください。少しくだけた、親しみやすい口調でお願いします。

# 出力形式
JSON形式で、以下のschemaに従って出力してください。
`;
            // 期待するJSONスキーマの定義
            const schema = {
                type: "OBJECT",
                properties: {
                    message: { type: "STRING" },
                    author: { type: "STRING", description: "例: 「普通科1年 男子」や「吹奏楽部 2年 女子」" }
                },
                required: ["message", "author"]
            };

            // APIリクエストのペイロード
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: schema,
                    temperature: 0.8 // メッセージの多様性を調整
                }
            };
            
            // Gemini APIを呼び出し
            const result = await callGemini(payload);

            // 結果の表示
            if (result.error) {
                messageContainer.innerHTML = `<p class="text-red-600 font-bold p-4">エラー: ${result.error}</p>`;
            } else {
                // 次の色を決定
                colorIndex = (colorIndex + 1) % messageColors.length;
                const color = messageColors[colorIndex];

                // 新しいメッセージのHTMLを生成して表示
                const newHTML = `
                    <div class="w-20 h-20 rounded-full ${color.icon} flex-shrink-0 flex items-center justify-center text-white text-3xl font-bold shadow-lg fade-in">
                        <span>新</span>
                    </div>
                    <div class="${color.bg} p-6 rounded-lg flex-grow fade-in">
                        <p class="font-semibold ${color.text}">${result.message}</p>
                        <p class="text-right mt-2 text-sm text-gray-600">- ${result.author}</p>
                    </div>
                `;
                messageContainer.innerHTML = newHTML;
            }
            // ボタンを再度有効化
            newMessageBtn.disabled = false;
        });

    </script>
</body>
</html>

